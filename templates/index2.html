<!DOCTYPE html>
<html>
<head>
    <title>knockNOC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #0F0;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        h1 {
            font-size: 48px;
            margin: 20px;
            text-align: center;
            text-transform: uppercase;
            animation: glitch 2s infinite;
        }

        .status-bar {
            display: flex;
            align-items: center;
            margin: 10px;
        }

        .status-box {
            width: 10px;
            height: 10px;
            margin-right: 5px;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        .status-box.up {
            background-color: #0F0;
        }

        .status-box.down {
            background-color: red;
        }

        p {
            margin: 10px;
            animation: typing 5s steps(20) infinite;
        }

        @keyframes glitch {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            25% {
                transform: translate(-2px, -2px);
                opacity: 0.75;
            }
            50% {
                transform: translate(2px, 2px);
                opacity: 0.9;
            }
            75% {
                transform: translate(-2px, 2px);
                opacity: 0.75;
            }
            100% {
                transform: translate(0, 0);
                opacity: 1;
            }
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }

        @keyframes typing {
            from {
                width: 0;
            }
            to {
                width: 100%;
            }
        }

        /* Cyberpunk style enhancements */
        .neon {
            color: #0F0;
            text-shadow: 0 0 5px #0F0, 0 0 10px #0F0, 0 0 20px #0F0, 0 0 30px #0F0;
            animation: neon-glow 1s ease-in-out infinite alternate;
        }

        @keyframes neon-glow {
            from {
                text-shadow: 0 0 5px #0F0, 0 0 10px #0F0, 0 0 20px #0F0, 0 0 30px #0F0;
            }
            to {
                text-shadow: 0 0 10px #0F0, 0 0 20px #0F0, 0 0 30px #0F0, 0 0 40px #0F0;
            }
        }

        .glitch-effect {
            position: relative;
            display: inline-block;
        }

        .glitch-effect::before,
        .glitch-effect::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
        }

        .glitch-effect::before {
            left: 2px;
            text-shadow: -2px 0 #0F0;
            background: #000;
            animation: glitch-effect-1 2s infinite linear alternate-reverse;
        }

        .glitch-effect::after {
            left: -2px;
            text-shadow: -2px 0 #0F0;
            background: #000;
            animation: glitch-effect-2 3s infinite linear alternate-reverse;
        }

        @keyframes glitch-effect-1 {
            0% {
                transform: skew(0);
            }
            25% {
                transform: skew(0.5deg, -0.1deg);
            }
            50% {
                transform: skew(-0.8deg, 0.2deg);
            }
            75% {
                transform: skew(0.2deg, 0.1deg);
            }
            100% {
                transform: skew(0);
            }
        }

        @keyframes glitch-effect-2 {
            0% {
                transform: skew(0);
            }
            25% {
                transform: skew(-0.3deg, 0.2deg);
            }
            50% {
                transform: skew(0.2deg, -0.5deg);
            }
            75% {
                transform: skew(-0.4deg, 0.1deg);
            }
            100% {
                transform: skew(0);
            }
        }
    </style>
</head>
<body>
    <h1 class="glitch-effect" data-text="knockNOC">knockNOC</h1>

    {% for endpoint, pings in results.items() %}
        <h2 class="neon">{{ endpoint }}</h2>
        <div class="status-bar">
            {% for status, response_time in pings %}
                <div class="status-box {% if status %}up{% else %}down{% endif %}"></div>
            {% endfor %}
        </div>
        <p class="neon">Uptime: <span class="uptime-{{ endpoint }}">{{ pings | calculate_uptime }}</span>%</p>
        <p class="neon">Response Time: <span class="response-time-{{ endpoint }}">{{ pings | calculate_response_time }}</span></p>
    {% endfor %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Function to update the pings data
            function updatePings(data) {
                // Update the pings data for each endpoint
                Object.keys(data).forEach(function(endpoint) {
                    var pings = data[endpoint];
    
                    // Update the uptime and response time values
                    $('.uptime-' + endpoint).text(pings.calculate_uptime);
                    $('.response-time-' + endpoint).text(pings.calculate_response_time);
    
                    // Clear the status bar
                    $('.status-bar').empty();
    
                    // Rebuild the status bar with the updated pings
                    pings.forEach(function(ping) {
                        var statusBox = $('<div class="status-box"></div>');
                        if (ping.status) {
                            statusBox.addClass('up');
                        } else {
                            statusBox.addClass('down');
                        }
                        $('.status-bar').append(statusBox);
                    });
                });
            }
    
            // Connect to the WebSocket server
            var socket = new WebSocket('ws://' + window.location.host + '/ws');
    
            // Event listener for WebSocket connection established
            socket.onopen = function(event) {
                console.log('WebSocket connection established.');
            };
    
            // Event listener for WebSocket messages received
            socket.onmessage = function(event) {
                var data = JSON.parse(event.data);
                updatePings(data);
            };
    
            // Event listener for WebSocket connection closed
            socket.onclose = function(event) {
                console.log('WebSocket connection closed.');
            };
    
            // Function to reload the page
            function reloadPage() {
                location.reload();
            }
    
            // Set an interval to reload the page every 10 seconds
            setInterval(reloadPage, 10000);
        });
    </script>    
</body>
</html>
